<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>礼来家庭日</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --lilly-red: #E1251B;
            --lilly-pink: #FBCFC8;
            --lilly-black: #212121;
            --lilly-green-light: #e0f2f1;
            --lilly-green-dark: #00796b;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #111827;
        }
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;
        }
        #app-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative; 
        }
        #app-container::-webkit-scrollbar {
            display: none;  
        }
        .font-ringside {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }
        .page {
            display: none;
            animation: fadeIn 0.5s;
            min-height: 100%;
            flex-direction: column;
            width: 100%;
            box-sizing: border-box;
            background-color: white;
        }
        .page.full-height {
             height: 100%;
        }
        .page-content {
            flex-grow: 1;
            padding: 1.5rem;
        }
        .sticky-footer {
            position: sticky;
            bottom: 0;
            background-color: white;
            padding: 0.75rem 1.5rem 1.5rem 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .custom-modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(4px);
        }
        .custom-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .custom-modal-content {
            background: white;
            border-radius: 1rem;
            width: 90%;
            max-width: 780px; /* Enlarged by ~1.3x from 600px */
            transform: scale(0.95);
            transition: transform 0.3s ease;
            display: flex;
            padding: 0;
            overflow: hidden;
        }
        .custom-modal-overlay.visible .custom-modal-content {
             transform: scale(1);
        }
        .modal-image-container {
            width: 45%;
            flex-shrink: 0;
        }
        .modal-text-container {
            width: 55%;
            padding: 2rem;
            text-align: left;
            display: flex;
            flex-direction: column;
        }
        .custom-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }
        .custom-modal-text {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }

        @keyframes pulse-scale {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.7));
            }
            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 10px rgba(255, 255, 255, 1));
            }
        }
        .map-hotspot {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            animation: pulse-scale 2.5s infinite ease-in-out;
            transition: transform 0.2s;
        }
        .map-hotspot:hover {
            transform: scale(1.15);
        }
        .map-icon {
            width: 44px;
            height: 44px;
            background-color: rgba(251, 191, 36, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .map-label {
            margin-top: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
        }
        .map-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.5), transparent);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 50;
        }
        .map-nav-btn {
            background-color: rgba(255,255,255,0.9);
            color: #1f2937;
            border-radius: 16px;
            padding: 0.75rem 0;
            width: 120px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        .map-nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .scratch-container {
            position: relative;
            width: 100%;
            cursor: crosshair;
            border-radius: 0.75rem;
            overflow: hidden;
        }
        .scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }
        
        #explore-fab {
            position: fixed;
            top: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 60;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            animation: pulse-scale 2.0s infinite ease-in-out;
            filter: drop-shadow(0 0 10px rgba(245, 158, 11, 1));
        }
        
        #orientation-lock {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #111827;
            color: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        @media (orientation: portrait) {
            #orientation-lock {
                display: flex;
            }
            #app-container {
                display: none;
            }
        }

    </style>
</head>
<body>
    <div id="orientation-lock">
        <svg class="w-16 h-16 mb-4 transform rotate-90" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        <p class="text-lg font-semibold">为了获得最佳体验</p>
        <p>请旋转您的设备至横屏模式</p>
    </div>

    <div id="app-container">
    </div>
    
    <div id="customModal" class="custom-modal-overlay">
        <div class="custom-modal-content">
            <div class="modal-image-container">
                <img data-id="modalImage" src="" class="w-full h-full object-cover">
            </div>
            <div class="modal-text-container">
                <h3 data-id="modalTitle" class="custom-modal-title font-ringside">提示</h3>
                <p data-id="modalText" class="custom-modal-text">这是一个提示信息。</p>
                <button data-id="modalCloseBtn" class="w-full lilly-button font-bold py-3 px-4 rounded-lg mt-auto">关闭</button>
            </div>
        </div>
    </div>

    <div id="exploreModal" class="custom-modal-overlay">
         <div class="custom-modal-content !p-6 !max-w-md !flex-col">
            <h3 class="custom-modal-title font-ringside">开启你的探索之旅！</h3>
            <p class="custom-modal-text">三大主题世界，乐趣各不相同。选择一个，亲手揭开它的神秘面纱吧！</p>
            <div class="space-y-3 mt-4 w-full">
                <div data-action="showScratchPage" data-type="fun" class="p-4 bg-gradient-to-br from-yellow-200 to-amber-300 rounded-xl cursor-pointer text-left">
                    <h4 class="font-bold text-lg text-amber-800 font-ringside">「趣」· 奇想世界</h4>
                    <p class="text-sm text-amber-700 mt-1">亲近自然，放飞童心！</p>
                </div>
                <div data-action="showScratchPage" data-type="win" class="p-4 bg-gradient-to-br from-red-200 to-rose-300 rounded-xl cursor-pointer text-left">
                    <h4 class="font-bold text-lg text-rose-800 font-ringside">「赢」· 卡路里战场</h4>
                    <p class="text-sm text-rose-700 mt-1">团队集结，为荣誉而战！</p>
                </div>
                <div data-action="showScratchPage" data-type="diy" class="p-4 bg-gradient-to-br from-purple-200 to-violet-300 rounded-xl cursor-pointer text-left">
                    <h4 class="font-bold text-lg text-violet-800 font-ringside">「作」· 慢时光工坊</h4>
                    <p class="text-sm text-violet-700 mt-1">静下心，与家人共创温馨。</p>
                </div>
            </div>
            <button data-action="closeExploreModal" class="w-full mt-6 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg">返回地图</button>
        </div>
    </div>

<template id="app-template">
    <div id="splashPage" class="page flex flex-col justify-end items-center text-center p-8 bg-cover bg-center" style="background-image: url('https://raw.githubusercontent.com/gaoshijun1983-collab/Lilly-H5/main/1.1%20%E5%BC%80%E5%B1%8F%E9%A1%B5%E4%B8%BB%E8%A7%86%E8%A7%89%EF%BC%881179%C3%972556%EF%BC%89.png'); height: 100%;">
        <button data-action="showPage" data-page="verificationPage" class="w-full max-w-xs bg-white text-red-600 font-bold py-4 px-4 rounded-full shadow-2xl transition-transform transform hover:scale-105 animate-pulse-slow mb-12 font-ringside">
             开启家庭日之旅
        </button>
    </div>

    <div id="verificationPage" class="page flex items-center justify-center p-6 bg-gray-50">
        <div class="bg-white rounded-2xl p-8 shadow-xl text-center w-full max-w-sm">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-ringside" style="color: var(--lilly-red);">员工身份验证</h2>
            <p class="text-gray-600 mb-6">请输入您的信息以继续</p>
            <div class="space-y-4">
                <input data-id="employeeIdInput" type="text" placeholder="员工号" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                <input data-id="employeeNameInput" type="text" placeholder="姓名" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                <input data-id="employeePhoneInput" type="tel" placeholder="电话" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
            </div>
            <p data-id="verificationError" class="text-red-500 text-sm mt-2 h-5"></p>
            <button data-action="verifyEmployee" class="w-full lilly-button font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-transform transform hover:scale-105 mt-4">
                验证进入
            </button>
        </div>
    </div>
    
    <div id="mapPage" class="page full-height bg-cover bg-center" style="background-image: url('https://raw.githubusercontent.com/gaoshijun1983-collab/Lilly-H5/main/WechatIMG1398.jpg');">
        <div class="absolute top-4 left-4 p-3 bg-white/80 backdrop-blur-sm rounded-lg shadow-lg text-gray-700 max-w-xs animate-pulse-slow">
            <h2 class="font-bold font-ringside text-base text-lilly-red">一份可以触摸的快乐地图</h2>
            <p class="text-xs mt-1">点击闪烁的图标，探索你的专属家庭日时光！</p>
        </div>
        
        <div class="relative w-full h-full">
            <div data-action="showPage" data-page="badmintonIntroPage" class="map-hotspot" style="top: 65%; left: 15%; animation-delay: 0.2s; transform: scale(1.1);">
                <div class="map-icon" style="width: 50px; height: 50px; font-size: 28px; background-color: #ef4444;">🏸</div>
                <div class="map-label" style="font-size: 14px; padding: 4px 12px;">「谁羽争锋」大赛</div>
            </div>
            <div data-action="showHighlight" data-highlight="event" class="map-hotspot" style="top: 75%; left: 50%; transform: translateX(-50%);">
                <div class="map-icon">💥</div>
                <div class="map-label">尖叫搏击赛</div>
            </div>
             <div data-action="showHighlight" data-highlight="crafts" class="map-hotspot" style="top: 40%; left: 18%; animation-delay: 0.4s; transform: scale(1.1);">
                <div class="map-icon" style="width: 50px; height: 50px; font-size: 28px; background-color: #a855f7;">🎨</div>
                <div class="map-label" style="font-size: 14px; padding: 4px 12px;">慢时光工坊</div>
            </div>
            <div data-action="showHighlight" data-highlight="offroad" class="map-hotspot" style="top: 20%; left: 80%; animation-delay: 0.3s;">
                <div class="map-icon">🚙</div>
                <div class="map-label">越野车</div>
            </div>
             <div data-action="showHighlight" data-highlight="picking" class="map-hotspot" style="top: 45%; left: 80%;">
                <div class="map-icon">🧺</div>
                <div class="map-label">采摘乐园</div>
            </div>
            <div data-action="showHighlight" data-highlight="party" class="map-hotspot" style="top: 78%; left: 78%; animation-delay: 0.5s;">
                <div class="map-icon">🔥</div>
                <div class="map-label">篝火派对</div>
            </div>
            <div data-action="showHighlight" data-highlight="fireworks" class="map-hotspot" style="top: 73%; left: 85%;">
                 <div class="map-icon">🎆</div>
                 <div class="map-label">烟花秀</div>
            </div>
        </div>

        <div id="explore-fab" data-action="openExploreModal">
            <div class="map-icon" style="width: 52px; height: 52px; font-size: 28px; background-color: #f59e0b;">🧭</div>
            <div class="map-label" style="font-size: 14px; padding: 4px 10px;">探索全场</div>
        </div>

        <nav class="map-nav">
            <button data-action="showPage" data-page="registrationPage" class="map-nav-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                <span>报名入口</span>
            </button>
            <button data-action="showPhotoAlbum" class="map-nav-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <span>精彩瞬间</span>
            </button>
            <button data-action="showMyBookings" class="map-nav-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg>
                <span>我的凭证</span>
            </button>
        </nav>
    </div>

    <div id="scratchPage" class="page">
        <div class="page-content">
            <h2 data-id="scratchTitle" class="text-3xl font-bold mb-2 font-ringside"></h2>
            <p class="text-gray-600 mb-4">擦亮这片区域，看看藏着哪些奇妙乐趣！</p>
            
            <div data-id="scratchContainer" class="scratch-container">
                <canvas data-id="scratchCanvas" class="scratch-canvas"></canvas>
                <div data-id="scratchContent" class="p-4 bg-gray-50 rounded-lg">
                    <div data-id="activityListContainer" class="space-y-4">
                    </div>
                     <p class="text-center text-sm text-gray-500 mt-6 italic">是不是已经心动了？<br>更多未知的惊喜，期待你来现场亲自发现！</p>
                </div>
            </div>
        </div>
         <div class="sticky-footer">
            <button data-action="closeScratchPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回探索之旅</button>
        </div>
    </div>
    
    <div id="registrationPage" class="page">
         <div class="page-content">
            <h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">活动报名</h2>
            <div class="space-y-6">
                <div>
                    <label class="font-semibold text-gray-700">员工信息 (您本人)</label>
                    <div class="mt-2 p-4 bg-gray-100 rounded-lg">
                        <p><strong>工号:</strong> <span data-id="regEmployeeId"></span></p>
                        <p><strong>姓名:</strong> <span data-id="regEmployeeName"></span></p>
                        <p><strong>电话:</strong> <span data-id="regEmployeePhone"></span></p>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">家属信息</label>
                    <div class="mt-2 p-4 border rounded-lg space-y-4">
                        <div data-id="familyFormsContainer" class="space-y-3"></div>
                        <button data-action="addFamilyMemberForm" class="w-full bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition text-sm">
                            + 添加家属
                        </button>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">用餐安排 (三批次分流)</label>
                    <div class="space-y-2 mt-2">
                        <label class="flex items-center p-4 border rounded-lg has-[:checked]:bg-red-50 has-[:checked]:border-red-400">
                            <input type="radio" name="dining" value="17:00 - 17:40 (红票)" class="h-5 w-5" style="accent-color: var(--lilly-red);">
                            <span class="ml-3"><strong>批次一 (红票):</strong> 17:00 - 17:40</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
                            <input type="radio" name="dining" value="17:40 - 18:20 (蓝票)" class="h-5 w-5" checked>
                            <span class="ml-3"><strong>批次二 (蓝票):</strong> 17:40 - 18:20</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg has-[:checked]:bg-yellow-50 has-[:checked]:border-yellow-400">
                            <input type="radio" name="dining" value="18:20 - 19:00 (黄票)" class="h-5 w-5">
                            <span class="ml-3"><strong>批次三 (黄票):</strong> 18:20 - 19:00</span>
                        </label>
                    </div>
                </div>
                 <div>
                    <label class="font-semibold text-gray-700">出行方式</label>
                    <div class="flex gap-4 mt-2">
                         <label class="flex-1 flex items-center p-4 border rounded-lg has-[:checked]:bg-green-50 has-[:checked]:border-green-400">
                            <input type="radio" name="transport" value="公司大巴" class="h-5 w-5 text-green-600">
                            <span class="ml-3">公司大巴</span>
                        </label>
                         <label class="flex-1 flex items-center p-4 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                            <input type="radio" name="transport" value="自行前往" class="h-5 w-5 text-indigo-600" checked>
                            <span class="ml-3">自行前往</span>
                        </label>
                    </div>
                    <div data-id="transportDetails" class="mt-4"></div>
                </div>
                <button data-action="submitRegistration" class="w-full mt-8 lilly-button font-bold py-4 px-4 rounded-lg hover:opacity-90 transition-transform transform hover:scale-105">
                    确认信息，生成我的出发券
                </button>
            </div>
        </div>
         <div class="sticky-footer">
            <button data-action="showPage" data-page="mapPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">
                返回地图首页
            </button>
        </div>
    </div>
    
    <div id="successPage" class="page">
        <div class="page-content flex flex-col items-center justify-center text-center">
            <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6 mx-auto" style="background-color: var(--lilly-green-light);">
                <svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h2 class="text-3xl font-bold font-ringside" style="color: var(--lilly-red);">报名成功!</h2>
            <p class="text-gray-600 mt-2 mb-8">请凭此电子券在现场签到。</p>
            <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-xs">
                 <img data-id="qrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=LillyFamilyDay-Default" alt="模拟签到二维码" class="w-full rounded-md">
                 <p class="mt-4 font-semibold text-lg" data-id="successName"></p>
                 <p class="text-sm text-gray-500" data-id="successId"></p>
            </div>
            <div data-id="allMyBookings" class="mt-6 text-left w-full max-w-xs bg-gray-50 p-4 rounded-lg">
            </div>
        </div>
         <div class="sticky-footer">
              <button data-action="showPage" data-page="mapPage" class="w-full p-4 lilly-button rounded-xl text-center hover:opacity-90 transition font-semibold">
                返回地图首页
            </button>
        </div>
    </div>

    <div id="itemDetailPage" class="page">
        <div class="page-content">
            <img data-id="itemDetailImage" src="" class="w-full h-48 object-cover rounded-lg mb-4 shadow-md">
            <h2 data-id="itemDetailTitle" class="text-3xl font-bold mb-4 font-ringside"></h2>
            <p data-id="itemDetailDescription" class="text-gray-600 leading-relaxed"></p>
            <div class="mt-6 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-bold text-lg text-gray-800 mb-2">规则趣解</h3>
                <p data-id="itemDetailRules" class="text-gray-600 text-sm"></p>
            </div>
        </div>
        <div class="sticky-footer">
            <button data-id="itemDetailBackButton" data-action="showScratchPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回列表</button>
        </div>
    </div>
    
    <div id="badmintonIntroPage" class="page">
        <div class="page-content">
            <img src="https://images.unsplash.com/photo-1620246233762-2f618f2191b4?q=80&w=2564&auto=format&fit=crop" alt="羽毛球大赛主图" class="w-full h-40 object-cover rounded-lg mb-4 shadow-md">
            <h2 class="text-3xl font-bold font-ringside" style="color: var(--lilly-red);">「谁羽争锋」羽毛球大赛</h2>
            <p class="text-sm text-gray-500 mb-4">名额有限，先到先得！</p>
            <div class="text-gray-700 space-y-2 mb-6 text-sm">
                <p><strong>比赛时间：</strong>下午</p>
                <p><strong>比赛项目：</strong>男子单打、女子单打、混合双打</p>
                <p><strong>报名须知：</strong>所有员工及家属均可报名。混双项目可为您的搭档代填资料。</p>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-4 font-ringside">比赛报名通道</h3>
            <div class="space-y-4">
                <div data-action="showBadmintonRegPage" data-page="badmintonRegisterPage_mens" class="flex items-center justify-between bg-blue-100 p-4 rounded-lg cursor-pointer hover:bg-blue-200">
                    <div><p class="font-bold text-blue-800 font-ringside">男子单打</p><p class="text-sm text-blue-700">英雄集结，一战封王</p></div>
                    <div class="text-right text-sm"><p class="font-semibold text-blue-800">已报名: <span data-id="mens_count">0</span></p><p class="text-xs text-blue-600">剩余: <span data-id="mens_remain">16</span></p></div>
                </div>
                <div data-action="showBadmintonRegPage" data-page="badmintonRegisterPage_womens" class="flex items-center justify-between bg-pink-100 p-4 rounded-lg cursor-pointer hover:bg-pink-200">
                    <div><p class="font-bold text-pink-800 font-ringside">女子单打</p><p class="text-sm text-pink-700">铿锵玫瑰，赛场绽放</p></div>
                    <div class="text-right text-sm"><p class="font-semibold text-pink-800">已报名: <span data-id="womens_count">0</span></p><p class="text-xs text-pink-600">剩余: <span data-id="womens_remain">16</span></p></div>
                </div>
                <div data-action="showBadmintonRegPage" data-page="badmintonRegisterPage_mixed" class="flex items-center justify-between bg-purple-100 p-4 rounded-lg cursor-pointer hover:bg-purple-200">
                    <div><p class="font-bold text-purple-800 font-ringside">混合双打</p><p class="text-sm text-purple-700">最佳拍档，默契致胜</p></div>
                    <div class="text-right text-sm"><p class="font-semibold text-purple-800">已报名: <span data-id="mixed_count">0</span></p><p class="text-xs text-purple-600">剩余: <span data-id="mixed_remain">16</span></p></div>
                </div>
            </div>
        </div>
        <div class="sticky-footer">
            <button data-action="showPage" data-page="mapPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回地图首页</button>
        </div>
    </div>

    <div id="badmintonRegisterPage_mens" class="page badminton-reg-page">
        <div class="page-content"><h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">男子单打报名</h2><form class="space-y-4" data-type="mens"><p class="text-sm text-gray-600">请填写您的参赛信息。</p><input type="text" placeholder="姓名" name="name1" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone1" class="w-full px-4 py-3 border-2 rounded-lg" required><button type="submit" class="w-full mt-4 lilly-button font-bold py-3 rounded-lg hover:opacity-90">确认报名</button></form></div>
        <div class="sticky-footer"><button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回大赛介绍</button></div>
    </div>
    <div id="badmintonRegisterPage_womens" class="page badminton-reg-page">
        <div class="page-content"><h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">女子单打报名</h2><form class="space-y-4" data-type="womens"><p class="text-sm text-gray-600">请填写您的参赛信息。</p><input type="text" placeholder="姓名" name="name1" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone1" class="w-full px-4 py-3 border-2 rounded-lg" required><button type="submit" class="w-full mt-4 lilly-button font-bold py-3 rounded-lg hover:opacity-90" style="background-color: #ec4899;">确认报名</button></form></div>
        <div class="sticky-footer"><button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回大赛介绍</button></div>
    </div>
    <div id="badmintonRegisterPage_mixed" class="page badminton-reg-page">
        <div class="page-content"><h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">混合双打报名</h2><form class="space-y-6" data-type="mixed"><div><label class="font-semibold text-gray-700">队员一信息</label><div class="space-y-3 mt-2 p-4 border rounded-lg"><input type="text" placeholder="姓名" name="name1" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone1" class="w-full px-4 py-3 border-2 rounded-lg" required><select class="w-full px-4 py-3 border-2 rounded-lg bg-white" name="gender1" required><option value="" disabled selected>性别</option><option>男</option><option>女</option></select></div></div><div><label class="font-semibold text-gray-700">队员二信息 (您的搭档)</label><div class="space-y-3 mt-2 p-4 border rounded-lg"><input type="text" placeholder="姓名" name="name2" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone2" class="w-full px-4 py-3 border-2 rounded-lg" required><select class="w-full px-4 py-3 border-2 rounded-lg bg-white" name="gender2" required><option value="" disabled selected>性别</option><option>男</option><option>女</option></select></div></div><button type="submit" class="w-full mt-4 lilly-button font-bold py-3 rounded-lg hover:opacity-90" style="background-color: #a855f7;">确认报名</button></form></div>
        <div class="sticky-footer"><button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回大赛介绍</button></div>
    </div>
    
    <div id="badmintonSuccessPage" class="page">
        <div class="page-content text-center flex flex-col items-center justify-center">
             <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6 mx-auto" style="background-color: var(--lilly-green-light);"><svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
            <h2 class="text-3xl font-bold font-ringside" style="color: var(--lilly-red);">大赛报名成功!</h2>
            <p class="text-gray-600 mt-2 mb-8">比赛信息已记录，现场凭姓名签到。</p>
            <div data-id="b-success-info" class="text-left w-full max-w-xs bg-gray-50 p-4 rounded-lg"></div>
        </div>
        <div class="sticky-footer space-y-2">
            <button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 lilly-button rounded-xl text-center hover:opacity-90 transition font-semibold">返回大赛介绍</button>
            <button data-action="showMyBookings" class="w-full p-4 bg-gray-200 text-gray-800 rounded-xl text-center hover:bg-gray-300 transition font-semibold">查看我的所有报名</button>
        </div>
    </div>
</template>

<script>
    const HIGHLIGHT_DATA = {
        event: { title: "百人开团，尖叫搏击！", text: "忘掉拘束，释放天性！巨型道具和趣味规则，让每个人都能瞬间融入，引爆团队协作的无限能量！", img: "https://images.unsplash.com/photo-1593341641692-aa7a8a7f711b?q=80&w=2574&auto=format&fit=crop" },
        offroad: { title: "引擎轰鸣，尘土飞扬！", text: "想体验一把现实版的“速度与激情”吗？握紧方向盘，穿越崎岖赛道，体验肾上腺素飙升的极致快感！", img: "https://images.unsplash.com/photo-1610479593531-c5d9a5b3b3f8?q=80&w=2574&auto=format&fit=crop" },
        party: { title: "夜幕降临，压轴大戏！", text: "当篝火点燃，音乐响起，一场献给所有家庭的草坪派对正式开始。尽情舞动，享受此刻的惬意与自由！", img: "https://images.unsplash.com/photo-1588124239333-594a73f403e3?q=80&w=2574&auto=format&fit=crop" },
        fireworks: { title: "点亮夜空，定格璀璨！", text: "一场献给所有家庭的璀璨烟花秀，将为今天画上最亮的感叹号！抬头仰望，将这份美好永远珍藏。", img: "https://images.unsplash.com/photo-1533294262438-2895680215a2?q=80&w=2574&auto=format&fit=crop" },
        crafts: { title: "慢时光，亲手作！", text: "静下心，与家人共创温馨。这里是释放创意的艺术天地。亲手制作一件小物，把家庭日的专属回忆和温度一起带回家。", img: "https://images.unsplash.com/photo-1513364776144-60967b0f800f?q=80&w=2671&auto=format&fit=crop" },
        picking: { title: "奔跑吧，都市农夫！", text: "集结！根据神秘任务卡，冲向田野，寻找最新鲜的战利品。速度最快的队伍，将赢得丰收的荣耀！", img: "https://images.unsplash.com/photo-1567357504313-264259336946?q=80&w=2574&auto=format&fit=crop" }
    };

    const ACTIVITY_DATA = {
        fun: {
            title: "「趣」· 奇想世界",
            items: [
                { id: 'fun-1', title: '雀神争霸赛', subtitle: '巨型麻将，全家开杠', desc: '不止是手气，更是霸气！在放大的世界里，运筹帷幄，体验巨型麻将和上海敲麻的乐趣，看谁才是真正的麻坛霸主！', img: 'https://placehold.co/786x384/facc15/333?text=头图-6.5.1', thumb: 'https://placehold.co/128x128/facc15/333?text=缩略图-6.5.1', rules: '像麻坛高手一样对决！规则：4人一桌，巨型麻将牌，胡牌得分。别碰倒牌堆哦，不然全家笑翻天！限时20min，先胡者胜。' },
                { id: 'fun-2', title: '疯狂卡丁车', subtitle: '体验速度的快感', desc: '油门踩到底，烦恼全甩掉！来一场全家人的速度与激情，安全赛道，无限尖叫！', img: 'https://placehold.co/786x384/f97316/333?text=头图-6.5.2', thumb: 'https://placehold.co/128x128/f97316/333?text=缩略图-6.5.2', rules: '油门轰鸣，弯道超车！规则：安全头盔上阵，赛道限速，撞墙扣分。全家组队，第一个冲线拿大奖！别忘刹车哦~' },
                { id: 'fun-3', title: '田园小火车', subtitle: '悠闲观光之旅', desc: '呜呜~开往春天的列车发车啦！载上家人，环游童话般的农庄，每一帧都是风景。', img: 'https://placehold.co/786x384/84cc16/333?text=头图-6.5.3', thumb: 'https://placehold.co/128x128/84cc16/333?text=缩略图-6.5.3', rules: '慢悠悠，看风景！规则：排队上车，坐稳扶好。小火车环游一周，记得跟路边的稻草人打招呼呀！' },
                { id: 'fun-4', title: '水上碰碰船', subtitle: '夏日清凉大作战', desc: '夏日炎炎，水上开战！驾驶你的小船，撞走所有不开心，清凉一夏！', img: 'https://placehold.co/786x384/38bdf8/333?text=头图-6.5.4', thumb: 'https://placehold.co/128x128/38bdf8/333?text=缩略图-6.5.4', rules: '水上大战三百回合！规则：穿好救生衣，不许站立。目标是撞击对方船只的充气部分，别撞自己人哦！' },
            ]
        },
        win: {
            title: "「赢」· 卡路里战场",
            items: [
                { id: 'win-1', title: '进击的跳远', subtitle: '运气与勇气的对决', desc: '狭路相逢勇者胜！一步一跳，一猜一决，通往胜利的路上，不止需要大长腿，更需要好运气！', img: 'https://placehold.co/786x384/ef4444/333?text=头图-6.6.1', thumb: 'https://placehold.co/128x128/ef4444/333?text=缩略图-6.6.1', rules: '跳到“对手”面前，石头剪刀布！规则：输了就换队友从起点重来，赢了继续跳。谁先占领对方起点区谁就赢！' },
                { id: 'win-2', title: '巨型排球对抗赛', subtitle: '超乎想象的团队乐趣', desc: '团结就是力量！面对这个庞然大物，每一次托举都凝聚着团队的心跳。得分的瞬间，燃爆全场！', img: 'https://placehold.co/786x384/f97316/333?text=头图-6.6.2', thumb: 'https://placehold.co/128x128/f97316/333?text=缩略图-6.6.2', rules: '这个排球有点大！规则：团队协作，把球拍过网，落地得分。小心，别被球砸到，它真的很大！' },
            ]
        },
        diy: {
            title: "「作」· 慢时光工坊",
            items: [
                 { id: 'diy-1', title: '埃及马赛克灯', subtitle: '制作你的专属艺术品', desc: '亲手拼贴五彩斑斓的玻璃片，在光影交错中，打造一盏充满异域风情的土耳其马赛克灯。', img: 'https://placehold.co/786x384/c084fc/333?text=头图-6.7.1', thumb: 'https://placehold.co/128x128/c084fc/333?text=缩略图-6.7.1', rules: '体验土耳其的浪漫！规则：领取材料包，按照图纸或自由发挥，将彩色玻璃片粘贴在灯罩上，最后由工作人员帮你灌浆固定。' },
                 { id: 'diy-2', title: '手绘风铃', subtitle: '描绘夏日的声音', desc: '用画笔在清脆的玻璃风铃上描绘心情，创作一个独一无二的夏日风铃，让清风带去你的祝福。', img: 'https://placehold.co/786x384/a78bfa/333?text=头图-6.7.2', thumb: 'https://placehold.co/128x128/a78bfa/333?text=缩略图-6.7.2', rules: '画出夏天的声音！规则：选择你喜欢的玻璃风铃，用特制颜料在上面作画。画完后自然风干，就可以带走这份独一无二的纪念品。' },
            ]
        },
    };

    class H5App {
        constructor(rootId) {
            this.root = document.getElementById(rootId);
            this.appTemplate = document.getElementById('app-template');
            this.root.innerHTML = this.appTemplate.innerHTML;
            
            this.modal = document.getElementById('customModal');
            this.exploreModal = document.getElementById('exploreModal');

            this.state = {
                currentUser: null,
                currentPage: 'splashPage',
                currentScratchType: null,
                registrationData: null,
                tournamentRegistrationData: null,
            };

            this.init();
        }

        getEl(dataId) {
            return document.querySelector(`[data-id="${dataId}"]`);
        }
        getAllEl(selector) {
            return document.querySelectorAll(selector);
        }

        init() {
            this.loadState();
            this.attachEventListeners();
            
            if (this.state.currentUser) {
                this.showPage('mapPage');
            } else {
                this.showPage('splashPage');
            }
        }

        attachEventListeners() {
            document.body.addEventListener('click', (e) => {
                const target = e.target.closest('[data-action]');
                if (!target) return;
                const action = target.dataset.action;
                if (typeof this[action] === 'function') {
                    this[action](target);
                }
            });
        }
        
        showPage(target) {
            const pageId = typeof target === 'string' ? target : target.dataset.page;
            if(!pageId) return;

            this.state.currentPage = pageId;
            this.getAllEl('.page').forEach(p => p.style.display = 'none');
            const targetPage = this.root.querySelector(`#${pageId}`);
            
            if (targetPage) {
                targetPage.style.display = 'flex';
            }
            this.root.parentElement.scrollTo(0, 0);

            if (pageId === 'registrationPage' && this.state.currentUser) {
                this.populateRegistrationForm();
            }
             if (pageId === 'badmintonIntroPage') {
                this.updateBadmintonCounts();
            }
        }
        
        saveState() {
            localStorage.setItem('lillyFamilyDayState', JSON.stringify(this.state));
        }

        loadState() {
            const savedState = localStorage.getItem('lillyFamilyDayState');
            if (savedState) {
                this.state = JSON.parse(savedState);
            }
        }

        verifyEmployee() {
            const id = this.getEl('employeeIdInput').value.trim();
            const name = this.getEl('employeeNameInput').value.trim();
            const phone = this.getEl('employeePhoneInput').value.trim();

            if (id && name && phone) {
                this.state.currentUser = { id, name, phone };
                this.saveState();
                this.showPage('mapPage');
            } else {
                 this.showModal('提示', '请填写所有验证信息。');
            }
        }
        
        populateRegistrationForm() {
            // ... (Implementation as before)
        }

        submitRegistration() {
            // ... (Implementation as before)
        }

        updateSuccessPage() {
            if (!this.state.registrationData || !this.state.currentUser) return;
            // ... (Implementation as before)
        }

        showMyBookings() {
            if (this.state.registrationData) {
                this.updateSuccessPage();
                this.showPage('successPage');
            } else {
                this.showModal('提示', '您还没有报名家庭日活动，请先报名。');
            }
        }

        updateMyBookingsPage() {
           // ... (Implementation as before)
        }

        addFamilyMemberForm(memberData = {}) {
            // ... (Implementation as before)
        }

        removeFamilyMember(target) {
            target.closest('.family-member-form').remove();
        }

        updateTransportInfo(busSelection = null) {
            // ... (Implementation as before)
        }
        
        showModal(title, text, imgSrc = null) {
            this.modal.querySelector('.custom-modal-title').textContent = title;
            this.modal.querySelector('.custom-modal-text').textContent = text;
            const imgEl = this.modal.querySelector('[data-id="modalImage"]');
            
            if (imgSrc) {
                imgEl.src = imgSrc;
                imgEl.parentElement.style.display = 'block';
            } else {
                 imgEl.parentElement.style.display = 'none';
            }
            
            this.modal.classList.add('visible');
            this.modal.querySelector('[data-id="modalCloseBtn"]').onclick = () => this.hideModal();
        }

        hideModal() {
            this.modal.classList.remove('visible');
        }

        showHighlight(target) {
            const highlightKey = target.dataset.highlight;
            const data = HIGHLIGHT_DATA[highlightKey];
            if (data) {
                this.showModal(data.title, data.text, data.img);
            }
        }
        
        showPhotoAlbum() {
            this.showModal('敬请期待', '“精彩瞬间”云相册功能将在活动当日上线，为您记录每一个欢乐时刻！');
        }

        openExploreModal() {
            this.exploreModal.classList.add('visible');
        }
        closeExploreModal() {
            this.exploreModal.classList.remove('visible');
        }

        showScratchPage(target) {
            const type = target.dataset.type;
            this.state.currentScratchType = type;
            const data = ACTIVITY_DATA[type];
            this.getEl('scratchTitle').textContent = data.title;
            const container = this.getEl('activityListContainer');
            container.innerHTML = data.items.map(item => `
                <div data-action="showItemDetail" data-item-id="${item.id}" class="flex items-center bg-white rounded-lg p-4 cursor-pointer hover:bg-gray-200 transition">
                    <img src="${item.thumb}" alt="${item.title}" class="w-16 h-16 rounded-md object-cover flex-shrink-0">
                    <div class="ml-4">
                        <h4 class="font-bold font-ringside">${item.title}</h4>
                        <p class="text-sm text-gray-600">${item.subtitle}</p>
                    </div>
                </div>
            `).join('');
            this.closeExploreModal();
            this.showPage('scratchPage');
            this.initScratchCard();
        }
        
        closeScratchPage() {
            this.openExploreModal();
        }

        initScratchCard() {
            // ... (Implementation as before)
        }
        
        showItemDetail(target) {
            // ... (Implementation as before)
        }
        
        handleBadmintonRegistration(event) {
             event.preventDefault();
        }
        updateBadmintonCounts() {
            // ... (Implementation as before)
        }
        showBadmintonRegPage(target) {
             if (!this.state.registrationData) {
                this.showModal('报名限制', '请您先完成家庭日活动报名，才能报名羽毛球大赛哦！');
                return;
            }
            this.showPage(target.dataset.page);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        new H5App('app-container');
    });
</script>
</body>
</html>

