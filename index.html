<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>礼来家庭日</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --lilly-red: #E1251B;
            --lilly-pink: #FBCFC8;
            --lilly-black: #212121;
            --lilly-green-light: #e0f2f1;
            --lilly-green-dark: #00796b;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;
            background-color: #f3f4f6;
        }
        #app-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative; 
        }
        #app-container::-webkit-scrollbar {
            display: none;  
        }
        .font-ringside {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }
        .page {
            display: none;
            animation: fadeIn 0.5s;
            min-height: 100%;
            flex-direction: column;
            width: 100%;
            box-sizing: border-box;
            background-color: white;
        }
        .page.full-height {
             height: 100%;
        }
        .page-content {
            flex-grow: 1;
            padding: 1.5rem;
        }
        .sticky-footer {
            position: sticky;
            bottom: 0;
            background-color: white;
            padding: 0.75rem 1.5rem 1.5rem 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.95; }
        }
        .animate-pulse-slow {
            animation: pulse 2.5s infinite;
        }
        .lilly-button {
            background-color: var(--lilly-red);
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }
        .lilly-button-green {
            background-color: var(--lilly-green-dark);
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .animate-blink {
            animation: blink 1.5s infinite ease-in-out;
        }
        .custom-modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(4px);
        }
        .custom-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .custom-modal-content {
            background: white;
            padding: 2rem 1.5rem 1.5rem;
            border-radius: 1rem;
            text-align: center;
            width: 85%;
            max-width: 320px;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .custom-modal-overlay.visible .custom-modal-content {
             transform: scale(1);
        }
        .custom-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.75rem;
        }
        .custom-modal-text {
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <div id="app-container">
    </div>
    
    <div id="customModal" class="custom-modal-overlay">
        <div class="custom-modal-content">
            <h3 data-id="modalTitle" class="custom-modal-title">提示</h3>
            <p data-id="modalText" class="custom-modal-text">这是一个提示信息。</p>
            <button data-id="modalCloseBtn" class="w-full lilly-button font-bold py-3 px-4 rounded-lg">好的</button>
        </div>
    </div>

<template id="app-template">
    <div id="splashPage" class="page flex flex-col justify-end items-center text-center p-8 bg-cover bg-center" style="background-image: url('https://raw.githubusercontent.com/gaoshijun1983-collab/Lilly-H5/main/1.1%20%E5%BC%80%E5%B1%8F%E9%A1%B5%E4%B8%BB%E8%A7%86%E8%A7%89%EF%BC%881179%C3%972556%EF%BC%89.png'); height: 100%;">
        <div class="mb-12 w-full max-w-xs text-white" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
             <h1 class="text-4xl font-bold font-ringside">趣赢!当燃卡路‘礼’</h1>
             <p class="mt-2 text-lg">和最爱的人，做最燃的事！</p>
        </div>
        <button data-action="showPage" data-page="verificationPage" class="w-full max-w-xs bg-white text-red-600 font-bold py-4 px-4 rounded-full shadow-2xl transition-transform transform hover:scale-105 animate-pulse-slow mb-12 font-ringside">
             开启家庭日之旅
        </button>
    </div>

    <div id="verificationPage" class="page flex items-center justify-center p-6 bg-gray-50">
        <div class="bg-white rounded-2xl p-8 shadow-xl text-center w-full max-w-sm">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 font-ringside" style="color: var(--lilly-red);">员工身份验证</h2>
            <p class="text-gray-600 mb-6">请输入您的信息以继续</p>
            <div class="space-y-4">
                <input data-id="employeeIdInput" type="text" placeholder="员工号" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                <input data-id="employeeNameInput" type="text" placeholder="姓名" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                <input data-id="employeePhoneInput" type="tel" placeholder="电话" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
            </div>
            <p data-id="verificationError" class="text-red-500 text-sm mt-2 h-5"></p>
            <button data-action="verifyEmployee" class="w-full lilly-button font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-transform transform hover:scale-105 mt-4">
                验证进入
            </button>
        </div>
    </div>

    <div id="homePage" class="page full-height">
      <header class="text-center relative h-1/4 flex-shrink-0">
        <img src="https://images.unsplash.com/photo-1593341641692-aa7a8a7f711b?q=80&w=2574&auto=format&fit=crop" alt="礼来家庭日活动主视觉" class="w-full h-full object-cover">
         <div class="absolute inset-0 bg-black/20 flex items-center justify-center">
            <h1 class="text-white text-4xl font-bold font-ringside">Welcome!</h1>
        </div>
      </header>
    
      <main class="page-content flex-grow flex flex-col justify-start gap-5 pt-8">
          <button data-id="registerBtn" data-action="showPage" data-page="registrationPage" class="w-full text-left p-4 bg-blue-500 text-white rounded-xl shadow-lg flex justify-between items-center hover:bg-blue-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
            <div><h2 class="text-lg font-bold font-ringside">立即报名</h2><p class="text-sm opacity-80">填写信息，锁定席位</p></div><span class="text-2xl">&rarr;</span>
          </button>
    
          <button data-id="modifyBtn" data-action="showPage" data-page="registrationPage" class="hidden w-full text-left p-4 bg-orange-500 text-white rounded-xl shadow-lg justify-between items-center hover:bg-orange-600 transition">
            <div><h2 class="text-lg font-bold font-ringside">修改报名信息</h2><p class="text-sm opacity-80">调整您的报名选项</p></div><span class="text-2xl">&#9998;</span>
          </button>
    
          <button data-action="showPage" data-page="badmintonIntroPage" class="w-full text-left p-0 bg-gray-600 text-white rounded-xl shadow-lg flex justify-start items-end hover:opacity-90 transition relative overflow-hidden h-28 animate-blink">
             <img src="https://images.unsplash.com/photo-1554062235-917b459a456c?q=80&w=2574&auto=format&fit=crop" class="w-full h-full object-cover absolute inset-0">
            <div class="relative p-4 bg-gradient-to-t from-black/60 to-transparent w-full">
                <h2 class="text-lg font-bold font-ringside">「谁羽争锋」羽毛球大赛</h2>
                <p class="text-sm opacity-80">挥洒汗水，即刻报名！</p>
            </div>
          </button>
    
          <div class="grid grid-cols-2 gap-4">
            <button data-action="showPage" data-page="schedulePage" class="p-4 rounded-xl text-center hover:bg-teal-200 transition flex-grow flex flex-col justify-center items-center h-28 bg-teal-100">
              <h3 class="font-bold text-lg text-teal-800 font-ringside">活动日程</h3>
            </button>
            <button data-action="showPage" data-page="highlightsPage" class="p-4 rounded-xl text-center hover:bg-purple-200 transition flex-grow flex flex-col justify-center items-center h-28 bg-purple-100">
              <h3 class="font-bold text-lg text-purple-800 font-ringside">活动亮点</h3>
            </button>
          </div>
      </main>
    
       <div class="sticky-footer flex-shrink-0">
        <button data-action="showMyBookings" class="w-full p-4 lilly-button-green rounded-xl text-center hover:opacity-90 transition font-semibold shadow-lg">
          我的报名 (查看凭证)
        </button>
      </div>
    </div>
    
    <div id="registrationPage" class="page">
        <div class="page-content">
            <h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">活动报名</h2>
            <div class="space-y-6">
                <div>
                    <label class="font-semibold text-gray-700">员工信息 (您本人)</label>
                    <div class="mt-2 p-4 bg-gray-100 rounded-lg">
                        <p><strong>工号:</strong> <span data-id="regEmployeeId"></span></p>
                        <p><strong>姓名:</strong> <span data-id="regEmployeeName"></span></p>
                        <p><strong>电话:</strong> <span data-id="regEmployeePhone"></span></p>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">家属信息</label>
                    <div class="mt-2 p-4 border rounded-lg space-y-4">
                        <div data-id="familyFormsContainer" class="space-y-3"></div>
                        <button data-action="addFamilyMemberForm" class="w-full bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition text-sm">
                            + 添加家属
                        </button>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-gray-700">用餐安排 (三批次分流)</label>
                    <div class="space-y-2 mt-2">
                        <label class="flex items-center p-4 border rounded-lg has-[:checked]:bg-red-50 has-[:checked]:border-red-400">
                            <input type="radio" name="dining" value="17:00 - 17:40 (红票)" class="h-5 w-5" style="accent-color: var(--lilly-red);">
                            <span class="ml-3"><strong>批次一 (红票):</strong> 17:00 - 17:40</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
                            <input type="radio" name="dining" value="17:40 - 18:20 (蓝票)" class="h-5 w-5" checked>
                            <span class="ml-3"><strong>批次二 (蓝票):</strong> 17:40 - 18:20</span>
                        </label>
                        <label class="flex items-center p-4 border rounded-lg has-[:checked]:bg-yellow-50 has-[:checked]:border-yellow-400">
                            <input type="radio" name="dining" value="18:20 - 19:00 (黄票)" class="h-5 w-5">
                            <span class="ml-3"><strong>批次三 (黄票):</strong> 18:20 - 19:00</span>
                        </label>
                    </div>
                </div>
                 <div>
                    <label class="font-semibold text-gray-700">出行方式</label>
                    <div class="flex gap-4 mt-2">
                         <label class="flex-1 flex items-center p-4 border rounded-lg has-[:checked]:bg-green-50 has-[:checked]:border-green-400">
                            <input type="radio" name="transport" value="公司大巴" class="h-5 w-5 text-green-600">
                            <span class="ml-3">公司大巴</span>
                        </label>
                         <label class="flex-1 flex items-center p-4 border rounded-lg has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400">
                            <input type="radio" name="transport" value="自行前往" class="h-5 w-5 text-indigo-600" checked>
                            <span class="ml-3">自行前往</span>
                        </label>
                    </div>
                    <div data-id="transportDetails" class="mt-4"></div>
                </div>
                <button data-action="submitRegistration" class="w-full mt-8 lilly-button font-bold py-4 px-4 rounded-lg hover:opacity-90 transition-transform transform hover:scale-105">
                    确认信息，生成我的出发券
                </button>
            </div>
        </div>
         <div class="sticky-footer">
            <button data-action="showPage" data-page="homePage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">
                返回首页
            </button>
        </div>
    </div>
    
    <div id="successPage" class="page">
        <div class="page-content flex flex-col items-center justify-center text-center">
            <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6 mx-auto" style="background-color: var(--lilly-green-light);">
                <svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h2 class="text-3xl font-bold font-ringside" style="color: var(--lilly-red);">报名成功!</h2>
            <p class="text-gray-600 mt-2 mb-8">请凭此电子券在现场签到。</p>
            <div class="bg-white p-4 rounded-lg shadow-md w-full max-w-xs">
                 <img data-id="qrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=LillyFamilyDay-Default" alt="模拟签到二维码" class="w-full rounded-md">
                 <p class="mt-4 font-semibold text-lg" data-id="successName"></p>
                 <p class="text-sm text-gray-500" data-id="successId"></p>
            </div>
            <div data-id="allMyBookings" class="mt-6 text-left w-full max-w-xs bg-gray-50 p-4 rounded-lg">
            </div>
        </div>
         <div class="sticky-footer">
              <button data-action="showPage" data-page="homePage" class="w-full p-4 lilly-button rounded-xl text-center hover:opacity-90 transition font-semibold">
                返回首页
            </button>
        </div>
    </div>

    <div id="highlightsPage" class="page">
        <div class="page-content">
            <div class="relative w-full h-40 rounded-lg overflow-hidden mb-4 shadow-lg">
                <img src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=2670&auto=format&fit=crop" alt="活动亮点主图" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col justify-end p-4">
                    <h2 class="text-3xl font-bold text-white font-ringside">活动亮点</h2>
                    <p class="text-white italic">"动静结合的礼来家庭日世界"</p>
                </div>
            </div>

            <div class="space-y-4">
                 <div data-action="showListPage" data-page="funListPage" class="p-6 bg-gradient-to-br from-yellow-200 to-amber-300 rounded-xl cursor-pointer hover:shadow-lg transition flex items-center">
                     <div class="bg-white/50 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
                    <div>
                        <h3 class="font-bold text-xl text-amber-800 font-ringside">「趣」· 奇想世界</h3>
                        <p class="text-sm text-amber-700 mt-1">亲近自然，放飞童心！这里是全家人的游乐场，从田园小火车到巨型麻将，每一种快乐都无需思考，只需尽情投入。</p>
                    </div>
                 </div>
                 <div data-action="showListPage" data-page="winListPage" class="p-6 bg-gradient-to-br from-red-200 to-rose-300 rounded-xl cursor-pointer hover:shadow-lg transition flex items-center">
                       <div class="bg-white/50 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div>
                    <div>
                        <h3 class="font-bold text-xl text-rose-800 font-ringside">「赢」· 卡路里战场</h3>
                        <p class="text-sm text-rose-700 mt-1">团队集结，为荣誉而战！这里是挥洒汗水、燃烧卡路里的竞技场。每一次协作，每一次冲刺，都是团队精神最燃的证明！</p>
                    </div>
                 </div>
                 <div data-action="showListPage" data-page="diyListPage" class="p-6 bg-gradient-to-br from-purple-200 to-violet-300 rounded-xl cursor-pointer hover:shadow-lg transition flex items-center">
                       <div class="bg-white/50 p-3 rounded-full mr-4"><svg class="w-6 h-6 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></div>
                    <div>
                        <h3 class="font-bold text-xl text-violet-800 font-ringside">「作」· 慢时光工坊</h3>
                        <p class="text-sm text-violet-700 mt-1">静下心，与家人共创温馨。这里是释放创意的艺术天地。亲手制作一件小物，把家庭日的专属回忆和温度一起带回家。</p>
                    </div>
                 </div>
            </div>
        </div>
         <div class="sticky-footer">
            <button data-action="showPage" data-page="homePage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">
                返回首页
            </button>
        </div>
    </div>

    <div id="activityListPage" class="page">
        <div class="page-content">
             <h2 data-id="activityListTitle" class="text-3xl font-bold mb-6 font-ringside"></h2>
             <p data-id="activityListDesc" class="text-gray-600 mb-4"></p>
             <div data-id="activityListContainer" class="space-y-4">
             </div>
        </div>
        <div class="sticky-footer">
            <button data-action="showPage" data-page="highlightsPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回活动亮点</button>
        </div>
    </div>
    
    <div id="itemDetailPage" class="page">
        <div class="page-content">
            <img data-id="itemDetailImage" src="" class="w-full h-48 object-cover rounded-lg mb-4 shadow-md">
            <h2 data-id="itemDetailTitle" class="text-3xl font-bold mb-4 font-ringside"></h2>
            <p data-id="itemDetailDescription" class="text-gray-600 leading-relaxed"></p>
            <div class="mt-6 bg-gray-100 p-4 rounded-lg">
                <h3 class="font-bold text-lg text-gray-800 mb-2">规则趣解</h3>
                <p data-id="itemDetailRules" class="text-gray-600 text-sm"></p>
            </div>
        </div>
        <div class="sticky-footer">
            <button data-id="itemDetailBackButton" data-action="showListPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回列表</button>
        </div>
    </div>
    
    <div id="badmintonIntroPage" class="page">
        <div class="page-content">
            <img src="https://images.unsplash.com/photo-1620246233762-2f618f2191b4?q=80&w=2564&auto=format&fit=crop" alt="羽毛球大赛主图" class="w-full h-40 object-cover rounded-lg mb-4 shadow-md">
            <h2 class="text-3xl font-bold font-ringside" style="color: var(--lilly-red);">「谁羽争锋」羽毛球大赛</h2>
            <p class="text-sm text-gray-500 mb-4">名额有限，先到先得！</p>
            <div class="text-gray-700 space-y-2 mb-6 text-sm">
                <p><strong>比赛时间：</strong>下午</p>
                <p><strong>比赛项目：</strong>男子单打、女子单打、混合双打</p>
                <p><strong>报名须知：</strong>所有员工及家属均可报名。混双项目可为您的搭档代填资料。</p>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-4 font-ringside">比赛报名通道</h3>
            <div class="space-y-4">
                <div data-action="showBadmintonRegPage" data-page="badmintonRegisterPage_mens" class="flex items-center justify-between bg-blue-100 p-4 rounded-lg cursor-pointer hover:bg-blue-200">
                    <div><p class="font-bold text-blue-800 font-ringside">男子单打</p><p class="text-sm text-blue-700">英雄集结，一战封王</p></div>
                    <div class="text-right text-sm"><p class="font-semibold text-blue-800">已报名: <span data-id="mens_count">0</span></p><p class="text-xs text-blue-600">剩余: <span data-id="mens_remain">16</span></p></div>
                </div>
                <div data-action="showBadmintonRegPage" data-page="badmintonRegisterPage_womens" class="flex items-center justify-between bg-pink-100 p-4 rounded-lg cursor-pointer hover:bg-pink-200">
                    <div><p class="font-bold text-pink-800 font-ringside">女子单打</p><p class="text-sm text-pink-700">铿锵玫瑰，赛场绽放</p></div>
                    <div class="text-right text-sm"><p class="font-semibold text-pink-800">已报名: <span data-id="womens_count">0</span></p><p class="text-xs text-pink-600">剩余: <span data-id="womens_remain">16</span></p></div>
                </div>
                <div data-action="showBadmintonRegPage" data-page="badmintonRegisterPage_mixed" class="flex items-center justify-between bg-purple-100 p-4 rounded-lg cursor-pointer hover:bg-purple-200">
                    <div><p class="font-bold text-purple-800 font-ringside">混合双打</p><p class="text-sm text-purple-700">最佳拍档，默契致胜</p></div>
                    <div class="text-right text-sm"><p class="font-semibold text-purple-800">已报名: <span data-id="mixed_count">0</span></p><p class="text-xs text-purple-600">剩余: <span data-id="mixed_remain">16</span></p></div>
                </div>
            </div>
        </div>
        <div class="sticky-footer">
            <button data-action="showPage" data-page="homePage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回首页</button>
        </div>
    </div>

    <div id="badmintonRegisterPage_mens" class="page badminton-reg-page">
        <div class="page-content"><h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">男子单打报名</h2><form class="space-y-4" data-type="mens"><p class="text-sm text-gray-600">请填写您的参赛信息。</p><input type="text" placeholder="姓名" name="name1" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone1" class="w-full px-4 py-3 border-2 rounded-lg" required><button type="submit" class="w-full mt-4 lilly-button font-bold py-3 rounded-lg hover:opacity-90">确认报名</button></form></div>
        <div class="sticky-footer"><button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回大赛介绍</button></div>
    </div>
    <div id="badmintonRegisterPage_womens" class="page badminton-reg-page">
        <div class="page-content"><h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">女子单打报名</h2><form class="space-y-4" data-type="womens"><p class="text-sm text-gray-600">请填写您的参赛信息。</p><input type="text" placeholder="姓名" name="name1" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone1" class="w-full px-4 py-3 border-2 rounded-lg" required><button type="submit" class="w-full mt-4 lilly-button font-bold py-3 rounded-lg hover:opacity-90" style="background-color: #ec4899;">确认报名</button></form></div>
        <div class="sticky-footer"><button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回大赛介绍</button></div>
    </div>
    <div id="badmintonRegisterPage_mixed" class="page badminton-reg-page">
        <div class="page-content"><h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">混合双打报名</h2><form class="space-y-6" data-type="mixed"><div><label class="font-semibold text-gray-700">队员一信息</label><div class="space-y-3 mt-2 p-4 border rounded-lg"><input type="text" placeholder="姓名" name="name1" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone1" class="w-full px-4 py-3 border-2 rounded-lg" required><select class="w-full px-4 py-3 border-2 rounded-lg bg-white" name="gender1" required><option value="" disabled selected>性别</option><option>男</option><option>女</option></select></div></div><div><label class="font-semibold text-gray-700">队员二信息 (您的搭档)</label><div class="space-y-3 mt-2 p-4 border rounded-lg"><input type="text" placeholder="姓名" name="name2" class="w-full px-4 py-3 border-2 rounded-lg" required><input type="tel" placeholder="电话" name="phone2" class="w-full px-4 py-3 border-2 rounded-lg" required><select class="w-full px-4 py-3 border-2 rounded-lg bg-white" name="gender2" required><option value="" disabled selected>性别</option><option>男</option><option>女</option></select></div></div><button type="submit" class="w-full mt-4 lilly-button font-bold py-3 rounded-lg hover:opacity-90" style="background-color: #a855f7;">确认报名</button></form></div>
        <div class="sticky-footer"><button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">返回大赛介绍</button></div>
    </div>
    
    <div id="badmintonSuccessPage" class="page">
        <div class="page-content text-center flex flex-col items-center justify-center">
             <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6 mx-auto" style="background-color: var(--lilly-green-light);"><svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
            <h2 class="text-3xl font-bold font-ringside" style="color: var(--lilly-red);">大赛报名成功!</h2>
            <p class="text-gray-600 mt-2 mb-8">比赛信息已记录，现场凭姓名签到。</p>
            <div data-id="b-success-info" class="text-left w-full max-w-xs bg-gray-50 p-4 rounded-lg"></div>
        </div>
        <div class="sticky-footer space-y-2">
            <button data-action="showPage" data-page="badmintonIntroPage" class="w-full p-4 lilly-button rounded-xl text-center hover:opacity-90 transition font-semibold">返回大赛介绍</button>
            <button data-action="showMyBookings" class="w-full p-4 bg-gray-200 text-gray-800 rounded-xl text-center hover:bg-gray-300 transition font-semibold">查看我的所有报名</button>
        </div>
    </div>

    <div id="schedulePage" class="page">
        <div class="page-content">
            <h2 class="text-3xl font-bold mb-6 font-ringside" style="color: var(--lilly-red);">活动日程</h2>
            
            <div class="relative border-l-2 border-red-200 ml-4">
                <div class="mb-8 ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                        <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM5 10a1 1 0 011-1h2V7a1 1 0 012 0v2h2a1 1 0 110 2h-2v2a1 1 0 11-2 0v-2H6a1 1 0 01-1-1z"></path></svg>
                    </span>
                    <h3 class="flex items-center mb-1 text-lg font-semibold text-gray-900">签到 & 礼品兑换 <span class="bg-red-100 text-red-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded ml-3">能量开启</span></h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">13:00 - 14:30</time>
                    <p class="text-base font-normal text-gray-600">集合签到, 领取家庭礼包、餐券、抽奖券，开启阳光普照奖兑换！</p>
                </div>
                <div class="mb-8 ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                         <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z"></path></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-900">开场仪式</h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">14:00 - 14:30</time>
                    <p class="text-base font-normal text-gray-600">热力健身操开场，随后领导致辞，全员大合影，定格精彩瞬间。</p>
                </div>
                <div class="mb-8 ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                         <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"></path></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-900">大型团队破冰</h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">14:30 - 15:20</time>
                    <p class="text-base font-normal text-gray-600">大型团队游戏 “暴打尖叫鸡”，点燃全场热情！</p>
                </div>
                 <div class="mb-8 ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                         <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M14.5 12a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM3.5 12a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM10 5.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 14.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM14.5 5.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-900">自由探索 & 能量收集</h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">15:20 - 18:00</time>
                    <p class="text-base font-normal text-gray-600">尽情体验中小型游戏、DIY手作和桌游，收集“能量贴纸”，品尝美味小吃。</p>
                </div>
                 <div class="mb-8 ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                         <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.518.759a1.156 1.156 0 00-.43 1.639l4.748 4.748a1.156 1.156 0 001.639-.43l.758-1.518a1 1 0 011.06-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-900">晚餐时间</h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">18:00 - 19:00</time>
                    <p class="text-base font-normal text-gray-600">凭餐券分时段享用美味自助餐，品尝烧烤、地锅鸡和农家菜。</p>
                </div>
                 <div class="mb-8 ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                         <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v1H5V4zM5 7h10v9a2 2 0 01-2 2H7a2 2 0 01-2-2V7zm3 3a1 1 0 00-1 1v2a1 1 0 102 0v-2a1 1 0 00-1-1z"></path></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-900">草坪狂欢夜</h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">19:00 - 19:45</time>
                    <p class="text-base font-normal text-gray-600">草坪音乐会、篝火派对、舞龙表演、烟花大秀、夜游小火车，将快乐推向高潮！</p>
                </div>
                 <div class="ml-8">
                    <span class="absolute flex items-center justify-center w-8 h-8 bg-red-200 rounded-full -left-4 ring-4 ring-white">
                         <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path d="M5 2a1 1 0 011 1v1h8V3a1 1 0 112 0v1h1a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2h1V3a1 1 0 011-1zm1 10a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2zm3 0a1 1 0 100-2 1 1 0 000 2z"></path></svg>
                    </span>
                    <h3 class="text-lg font-semibold text-gray-900">能量之星 & 幸运抽奖</h3>
                    <time class="block mb-2 text-sm font-normal leading-none text-gray-500">19:45 - 20:00</time>
                    <p class="text-base font-normal text-gray-600">抽取“能量之星”与老板互动，并揭晓最终的幸运大奖。</p>
                </div>
            </div>

        </div>
        <div class="sticky-footer">
            <button data-action="showPage" data-page="homePage" class="w-full p-4 bg-gray-200 text-gray-700 rounded-xl text-center hover:bg-gray-300 transition font-semibold">
                返回首页
            </button>
        </div>
    </div>
</template>

<script>
    class H5App {
        constructor(rootId) {
            this.root = document.getElementById(rootId);
            this.appTemplate = document.getElementById('app-template');
            this.root.innerHTML = this.appTemplate.innerHTML;
            this.modal = document.getElementById('customModal');

            this.state = {
                currentUser: null,
                currentPage: 'splashPage',
                familyMemberCounter: 0,
                registrationData: null,
                tournamentRegistrationData: null,
            };

            this.init();
        }

        getEl(dataId) {
            return this.root.querySelector(`[data-id="${dataId}"]`) || this.modal.querySelector(`[data-id="${dataId}"]`);
        }
        
        getAllEl(selector) {
            return this.root.querySelectorAll(selector);
        }

        init() {
            this.loadState();
            this.attachEventListeners();
            
            if (this.state.currentUser) {
                this.showPage('homePage');
            } else {
                this.showPage('splashPage');
            }
        }

        attachEventListeners() {
            this.root.addEventListener('click', (e) => {
                const target = e.target.closest('[data-action]');
                if (!target) return;

                const action = target.dataset.action;
                if (typeof this[action] === 'function') {
                    this[action](target);
                }
            });

            this.getAllEl('.badminton-reg-page form').forEach(form => {
                form.addEventListener('submit', (e) => this.handleBadmintonRegistration(e));
            });
             this.getAllEl('input[name="transport"]').forEach(radio => {
                radio.addEventListener('change', () => this.updateTransportInfo());
            });
            this.getEl('modalCloseBtn').addEventListener('click', () => this.hideModal());
        }
        
        showPage(target) {
            const pageId = typeof target === 'string' ? target : target.dataset.page;
            this.state.currentPage = pageId;

            this.getAllEl('.page').forEach(p => p.style.display = 'none');
            const targetPage = this.root.querySelector(`#${pageId}`);
            
            if (targetPage) {
                targetPage.style.display = 'flex';
            }
            this.root.parentElement.scrollTo(0, 0);

            if (pageId === 'homePage') this.updateHomePageState();
            if (pageId === 'badmintonIntroPage') this.updateBadmintonCounts();
            if (pageId === 'registrationPage' && this.state.currentUser) {
                this.populateRegistrationForm();
            }
        }
        
        saveState() {
            localStorage.setItem('lillyFamilyDayState', JSON.stringify(this.state));
        }

        loadState() {
            const savedState = localStorage.getItem('lillyFamilyDayState');
            if (savedState) {
                this.state = JSON.parse(savedState);
            }
        }

        verifyEmployee() {
            const id = this.getEl('employeeIdInput').value.trim();
            const name = this.getEl('employeeNameInput').value.trim();
            const phone = this.getEl('employeePhoneInput').value.trim();

            if (id && name && phone) {
                this.state.currentUser = { id, name, phone };
                this.getEl('verificationError').textContent = '';
                this.saveState();
                this.showPage('homePage');
            } else {
                this.getEl('verificationError').textContent = '请填写所有验证信息。';
            }
        }
        
        populateRegistrationForm() {
            this.getEl('regEmployeeId').textContent = this.state.currentUser.id;
            this.getEl('regEmployeeName').textContent = this.state.currentUser.name;
            this.getEl('regEmployeePhone').textContent = this.state.currentUser.phone;

            this.getEl('familyFormsContainer').innerHTML = '';
            this.state.familyMemberCounter = 0;

            if (this.state.registrationData) {
                this.state.registrationData.familyMembers.forEach(member => {
                    this.addFamilyMemberForm(member);
                });
                this.root.querySelector(`input[name="dining"][value="${this.state.registrationData.dining}"]`).checked = true;
                this.root.querySelector(`input[name="transport"][value="${this.state.registrationData.transport}"]`).checked = true;
                this.updateTransportInfo(this.state.registrationData.transportDetails);
            } else {
                this.root.querySelector('input[name="dining"][value="17:40 - 18:20 (蓝票)"]').checked = true;
                this.root.querySelector('input[name="transport"][value="自行前往"]').checked = true;
                this.updateTransportInfo();
            }
        }

        submitRegistration() {
            const familyMembers = [];
            this.getAllEl('.family-member-form').forEach(form => {
                familyMembers.push({
                    relation: form.querySelector('select[name="relation"]').value,
                    name: form.querySelector('input[name="name"]').value,
                    ageGroup: form.querySelector('select[name="ageGroup"]').value,
                    gender: form.querySelector('select[name="gender"]').value,
                });
            });

            const transportChoice = this.root.querySelector('input[name="transport"]:checked').value;
            let transportDetails = '';
            if (transportChoice === '公司大巴') {
                transportDetails = this.getEl('busSelector')?.value || 'A点: 公司总部 (8:00 发车)';
            }

            this.state.registrationData = {
                dining: this.root.querySelector('input[name="dining"]:checked').value,
                transport: transportChoice,
                transportDetails: transportDetails,
                familyMembers: familyMembers,
            };

            this.saveState();
            this.updateSuccessPage();
            this.showPage('successPage');
        }

        updateSuccessPage() {
            if (!this.state.registrationData || !this.state.currentUser) return;
            
            const { name, id } = this.state.currentUser;
            this.getEl('successName').textContent = name;
            this.getEl('successId').textContent = `员工号: ${id}`;
            this.getEl('qrCode').src = `https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=LillyFamilyDay-${id}-${name}`;
            
            this.updateMyBookingsPage();
        }

        updateHomePageState() {
            if (this.state.registrationData) {
                const regBtn = this.getEl('registerBtn');
                regBtn.classList.add('hidden');
                
                const modifyBtn = this.getEl('modifyBtn');
                modifyBtn.classList.remove('hidden');
                modifyBtn.classList.add('flex');
            } else {
                 this.getEl('registerBtn').classList.remove('hidden');
                 this.getEl('modifyBtn').classList.add('hidden');
            }
        }

        showMyBookings() {
            if (this.state.registrationData) {
                this.updateSuccessPage();
                this.showPage('successPage');
            } else {
                this.showModal('提示', '您还没有报名家庭日活动，请先报名。');
            }
        }

        updateMyBookingsPage() {
            if (!this.state.registrationData) return;
            const container = this.getEl('allMyBookings');
            let html = '<h4 class="font-semibold mb-2">您的报名信息:</h4><div class="space-y-1 text-sm">';
            
            html += `<p><strong>用餐时段:</strong> ${this.state.registrationData.dining}</p>`;
            html += `<p><strong>出行方式:</strong> ${this.state.registrationData.transport}</p>`;
            if (this.state.registrationData.transport === '公司大巴') {
                 html += `<p class="pl-4 text-xs"><strong>乘车点:</strong> ${this.state.registrationData.transportDetails}</p>`;
            }
            html += `<p><strong>携带家属:</strong> ${this.state.registrationData.familyMembers.length} 人</p>`;

            if (this.state.tournamentRegistrationData) {
                 html += '<div class="mt-2 pt-2 border-t">';
                 html += '<h5 class="font-semibold text-sm">羽毛球大赛报名:</h5><div class="text-xs space-y-1">';
                 const data = this.state.tournamentRegistrationData.signup;
                 html += `<p><strong>项目:</strong> ${data.typeDisplay}</p>`;
                 html += `<p><strong>队员1:</strong> ${data.name1} (${data.phone1})</p>`;
                 if (data.name2) {
                     html += `<p><strong>队员2:</strong> ${data.name2} (${data.phone2})</p>`;
                 }
                 html += '</div></div>';
            } else {
                html += '<p class="text-xs text-gray-500 mt-1">未报名羽毛球大赛。</p>';
            }

            html += '</div>';
            container.innerHTML = html;
        }

        addFamilyMemberForm(memberData = null) {
            this.state.familyMemberCounter++;
            const container = this.getEl('familyFormsContainer');
            const formHtml = `
                <div class="p-3 bg-gray-50 rounded-lg border relative family-member-form">
                    <button data-action="removeFamilyMember" class="absolute top-1 right-2 text-gray-400 hover:text-red-500 font-bold text-xl">&times;</button>
                    <p class="font-semibold text-sm mb-2">家属 ${this.state.familyMemberCounter}</p>
                    <div class="grid grid-cols-2 gap-2">
                        <select name="relation" class="w-full border rounded-md p-2 text-sm" required>
                            <option value="" disabled>关系</option>
                            <option value="配偶" ${memberData?.relation === '配偶' ? 'selected' : ''}>配偶</option>
                            <option value="子女" ${memberData?.relation === '子女' ? 'selected' : ''}>子女</option>
                            <option value="父母" ${memberData?.relation === '父母' ? 'selected' : ''}>父母</option>
                            <option value="其他" ${memberData?.relation === '其他' ? 'selected' : ''}>其他</option>
                        </select>
                        <input type="text" name="name" placeholder="姓名" class="w-full border rounded-md p-2 text-sm" required value="${memberData?.name || ''}">
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                         <select name="ageGroup" class="w-full border rounded-md p-2 text-sm" required>
                            <option value="" disabled>年龄段</option>
                            <option ${memberData?.ageGroup === '0-3岁' ? 'selected' : ''}>0-3岁</option>
                            <option ${memberData?.ageGroup === '4-6岁' ? 'selected' : ''}>4-6岁</option>
                            <option ${memberData?.ageGroup === '7-12岁' ? 'selected' : ''}>7-12岁</option>
                            <option ${memberData?.ageGroup === '13-17岁' ? 'selected' : ''}>13-17岁</option>
                            <option ${memberData?.ageGroup === '18岁以上' ? 'selected' : ''}>18岁以上</option>
                         </select>
                        <select name="gender" class="w-full border rounded-md p-2 text-sm" required>
                            <option value="" disabled>性别</option>
                            <option ${memberData?.gender === '男' ? 'selected' : ''}>男</option>
                            <option ${memberData?.gender === '女' ? 'selected' : ''}>女</option>
                            <option ${memberData?.gender === '保密' ? 'selected' : ''}>保密</option>
                        </select>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', formHtml);
            if (!memberData) {
                container.lastElementChild.querySelector('select[name="relation"]').selectedIndex = 0;
                container.lastElementChild.querySelector('select[name="ageGroup"]').selectedIndex = 0;
                container.lastElementChild.querySelector('select[name="gender"]').selectedIndex = 0;
            }
        }

        removeFamilyMember(target) {
            target.closest('.family-member-form').remove();
        }

        updateTransportInfo(busSelection = null) {
            const transportChoice = this.root.querySelector('input[name="transport"]:checked')?.value;
            const detailsContainer = this.getEl('transportDetails');
            if (transportChoice === '自行前往') {
                detailsContainer.innerHTML = `<div class="p-4 bg-indigo-50 rounded-lg border border-indigo-200"><p class="font-semibold text-indigo-800">活动地址:</p><p class="text-sm text-indigo-700">上海市闵行区浦江镇联正路238号</p><a href="https://map.baidu.com/search/上海市闵行区浦江镇联正路238号" target="_blank" class="mt-2 inline-block bg-indigo-500 text-white text-sm font-bold py-2 px-4 rounded-lg hover:bg-indigo-600">点击导航</a></div>`;
            } else if (transportChoice === '公司大巴') {
                 const busASelected = busSelection === 'A点: 公司总部 (8:00 发车)' ? 'selected' : '';
                 const busBSelected = busSelection === 'B点: 人民广场 (8:30 发车)' ? 'selected' : '';
                detailsContainer.innerHTML = `<div class="p-4 bg-green-50 rounded-lg border border-green-200"><p class="font-semibold text-green-800">请选择乘车点:</p><select data-id="busSelector" class="w-full mt-2 border rounded-md p-2 text-sm"><option ${busASelected}>A点: 公司总部 (8:00 发车)</option><option ${busBSelected}>B点: 人民广场 (8:30 发车)</option></select></div>`;
            } else {
                detailsContainer.innerHTML = '';
            }
        }

        showModal(title, text) {
            this.getEl('modalTitle').textContent = title;
            this.getEl('modalText').textContent = text;
            this.modal.classList.add('visible');
        }

        hideModal() {
            this.modal.classList.remove('visible');
        }

        showListPage(target) {
            const pageType = target.dataset.page;
            const data = ACTIVITY_DATA[pageType];
            
            this.getEl('activityListTitle').textContent = data.title;
            this.getEl('activityListTitle').style.color = data.color;
            this.getEl('activityListDesc').textContent = data.description;

            const container = this.getEl('activityListContainer');
            container.innerHTML = data.items.map(item => `
                <div data-action="showItemDetail" data-item-id="${item.id}" class="flex items-center bg-gray-50 rounded-lg p-4 cursor-pointer hover:bg-gray-100 transition">
                    <img src="${item.thumb}" alt="${item.title}" class="w-16 h-16 rounded-md object-cover flex-shrink-0">
                    <div class="ml-4">
                        <h4 class="font-bold font-ringside">${item.title}</h4>
                        <p class="text-sm text-gray-600">${item.subtitle}</p>
                    </div>
                </div>
            `).join('');

            this.showPage('activityListPage');
        }

        showItemDetail(target) {
            const itemId = target.dataset.itemId;
            let item, backPageId;
            for (const key in ACTIVITY_DATA) {
                const foundItem = ACTIVITY_DATA[key].items.find(i => i.id === itemId);
                if (foundItem) {
                    item = foundItem;
                    backPageId = key;
                    break;
                }
            }

            if (item) {
                this.getEl('itemDetailTitle').textContent = item.title;
                this.getEl('itemDetailDescription').textContent = item.desc;
                this.getEl('itemDetailImage').src = item.img;
                this.getEl('itemDetailRules').textContent = item.rules;
                
                const backButton = this.getEl('itemDetailBackButton');
                backButton.dataset.page = backPageId;
                
                this.showPage('itemDetailPage');
            }
        }

        showBadmintonRegPage(target) {
            if (!this.state.registrationData) {
                this.showModal('报名限制', '请您先完成家庭日活动报名，才能报名羽毛球大赛哦！');
                return;
            }
            this.showPage(target);
        }
        
        updateBadmintonCounts() {
            const max = 16;
            const counts = this.state.tournamentRegistrationData?.counts || { mens: 0, womens: 0, mixed: 0 };

            this.getAllEl('[data-id="mens_count"]').forEach(el => el.textContent = counts.mens);
            this.getAllEl('[data-id="womens_count"]').forEach(el => el.textContent = counts.womens);
            this.getAllEl('[data-id="mixed_count"]').forEach(el => el.textContent = counts.mixed);
            this.getAllEl('[data-id="mens_remain"]').forEach(el => el.textContent = max - counts.mens);
            this.getAllEl('[data-id="womens_remain"]').forEach(el => el.textContent = max - counts.womens);
            this.getAllEl('[data-id="mixed_remain"]').forEach(el => el.textContent = max - counts.mixed);
        }

        handleBadmintonRegistration(event) {
            event.preventDefault();
            const form = event.target;
            const type = form.dataset.type;
            const max = 16;
            
            if (!this.state.tournamentRegistrationData) {
                this.state.tournamentRegistrationData = { counts: { mens: 0, womens: 0, mixed: 0 }};
            }
            
            if (this.state.tournamentRegistrationData.counts[type] >= max) {
                this.showModal('报名失败', '抱歉，该项目报名人数已满！');
                return;
            }

            const name1 = form.querySelector('input[name="name1"]').value;
            const phone1 = form.querySelector('input[name="phone1"]').value;
            const name2 = form.querySelector('input[name="name2"]')?.value;
            const phone2 = form.querySelector('input[name="phone2"]')?.value;
            
            let typeDisplay = '', infoHtml = '';

            switch(type) {
                case 'mens': typeDisplay = '男子单打'; infoHtml = `<p><strong>项目:</strong> ${typeDisplay}</p><p><strong>选手:</strong> ${name1}</p><p><strong>电话:</strong> ${phone1}</p>`; break;
                case 'womens': typeDisplay = '女子单打'; infoHtml = `<p><strong>项目:</strong> ${typeDisplay}</p><p><strong>选手:</strong> ${name1}</p><p><strong>电话:</strong> ${phone1}</p>`; break;
                case 'mixed': typeDisplay = '混合双打'; infoHtml = `<p><strong>项目:</strong> ${typeDisplay}</p><div class="mt-2 pt-2 border-t"><p><strong>队员1:</strong> ${name1} (${phone1})</p></div><div class="mt-1"><p><strong>队员2:</strong> ${name2} (${phone2})</p></div>`; break;
            }
            
            this.state.tournamentRegistrationData.signup = { type, typeDisplay, name1, phone1, name2, phone2 }; 
            this.state.tournamentRegistrationData.counts[type]++;
            
            this.getEl('b-success-info').innerHTML = infoHtml;
            
            this.saveState();
            this.updateBadmintonCounts();
            form.reset();
            this.showPage('badmintonSuccessPage');
        }
    }

    const ACTIVITY_DATA = {
        funListPage: {
            title: "「趣」· 奇想世界",
            color: "#ca8a04",
            description: "亲近自然，放飞童心！这里是全家人的游乐场，从田园小火车到巨型麻将，每一种快乐都无需思考，只需尽情投入。",
            items: [
                { id: 'fun-1', title: '雀神争霸赛', subtitle: '巨型麻将，全家开杠', desc: '不止是手气，更是霸气！在放大的世界里，运筹帷幄，体验巨型麻将和上海敲麻的乐趣，看谁才是真正的麻坛霸主！', img: 'https://placehold.co/786x384/facc15/333?text=头图-6.5.1', thumb: 'https://placehold.co/128x128/facc15/333?text=缩略图-6.5.1', rules: '像麻坛高手一样对决！规则：4人一桌，巨型麻将牌，胡牌得分。别碰倒牌堆哦，不然全家笑翻天！限时20min，先胡者胜。' },
                { id: 'fun-2', title: '疯狂卡丁车', subtitle: '体验速度的快感', desc: '油门踩到底，烦恼全甩掉！来一场全家人的速度与激情，安全赛道，无限尖叫！', img: 'https://placehold.co/786x384/f97316/333?text=头图-6.5.2', thumb: 'https://placehold.co/128x128/f97316/333?text=缩略图-6.5.2', rules: '油门轰鸣，弯道超车！规则：安全头盔上阵，赛道限速，撞墙扣分。全家组队，第一个冲线拿大奖！别忘刹车哦~' },
                { id: 'fun-3', title: '田园小火车', subtitle: '悠闲观光之旅', desc: '呜呜~开往春天的列车发车啦！载上家人，环游童话般的农庄，每一帧都是风景。', img: 'https://placehold.co/786x384/84cc16/333?text=头图-6.5.3', thumb: 'https://placehold.co/128x128/84cc16/333?text=缩略图-6.5.3', rules: '慢悠悠，看风景！规则：排队上车，坐稳扶好。小火车环游一周，记得跟路边的稻草人打招呼呀！' },
                { id: 'fun-4', title: '水上碰碰船', subtitle: '夏日清凉大作战', desc: '夏日炎炎，水上开战！驾驶你的小船，撞走所有不开心，清凉一夏！', img: 'https://placehold.co/786x384/38bdf8/333?text=头图-6.5.4', thumb: 'https://placehold.co/128x128/38bdf8/333?text=缩略图-6.5.4', rules: '水上大战三百回合！规则：穿好救生衣，不许站立。目标是撞击对方船只的充气部分，别撞自己人哦！' },
            ]
        },
        winListPage: {
            title: "「赢」· 卡路里战场",
            color: "#dc2626",
            description: "团队集结，为荣誉而战！这里是挥洒汗水、燃烧卡路里的竞技场。每一次协作，每一次冲刺，都是团队精神最燃的证明！",
            items: [
                { id: 'win-1', title: '进击的跳远', subtitle: '运气与勇气的对决', desc: '狭路相逢勇者胜！一步一跳，一猜一决，通往胜利的路上，不止需要大长腿，更需要好运气！', img: 'https://placehold.co/786x384/ef4444/333?text=头图-6.6.1', thumb: 'https://placehold.co/128x128/ef4444/333?text=缩略图-6.6.1', rules: '跳到“对手”面前，石头剪刀布！规则：输了就换队友从起点重来，赢了继续跳。谁先占领对方起点区谁就赢！' },
                { id: 'win-2', title: '巨型排球对抗赛', subtitle: '超乎想象的团队乐趣', desc: '团结就是力量！面对这个庞然大物，每一次托举都凝聚着团队的心跳。得分的瞬间，燃爆全场！', img: 'https://placehold.co/786x384/f97316/333?text=头图-6.6.2', thumb: 'https://placehold.co/128x128/f97316/333?text=缩略图-6.6.2', rules: '这个排球有点大！规则：团队协作，把球拍过网，落地得分。小心，别被球砸到，它真的很大！' },
                { id: 'win-3', title: '木头人匹克球', subtitle: '从解救队友开始', desc: '从“被封印”到“绝地反击”！蹲下是积蓄力量，起身是扭转乾坤。来吧，解锁你的自由，赢下这场翻身仗！', img: 'https://placehold.co/786x384/f59e0b/333?text=头图-6.6.3', thumb: 'https://placehold.co/128x128/f59e0b/333?text=缩略图-6.6.3', rules: '解救你的“木头人”队友！规则：发球方需要先让蹲着的队友接到球才能解锁。全员解锁后，进入正常得分模式。' },
                { id: 'win-4', title: '足球斯诺克', subtitle: '大力出奇迹', desc: '当绿茵场遇上台球桌，用脚法代替巧劲！精准推杆，大力抽射，你就是下一个“黄金右脚”斯诺克大师！', img: 'https://placehold.co/786x384/10b981/333?text=头图-6.6.4', thumb: 'https://placehold.co/128x128/10b981/333?text=缩略图-6.6.4', rules: '用脚踢的斯诺克！规则：选择纯色或花色球，用白色主球把你的所有球踢进洞，最后踢黑八。小心别犯规哦！' },
                { id: 'win-5', title: '动物赛跑', subtitle: '萌宠总动员', desc: '超级萌宠大暴走！拿起你的芭蕉扇，看看谁才是真正的“赶G人”。这不仅是速度赛，更是策略与耐心的考验！', img: 'https://placehold.co/786x384/6366f1/333?text=头图-6.6.5', thumb: 'https://placehold.co/128x128/6366f1/333?text=缩略图-6.6.5', rules: '快扇风，让你的小鸡快跑！规则：只能用扇子扇气球前进，手碰到就犯规啦。最先到达终点的队伍获胜！' },
                { id: 'win-6', title: '投球挑战', subtitle: '一击即中赢大奖', desc: '屏息凝神，就现在！每一次抛物线都承载着赢得大奖的希望。三球定胜负，看看你能抱走几等奖？', img: 'https://placehold.co/786x384/8b5cf6/333?text=头图-6.6.6', thumb: 'https://placehold.co/128x128/8b5cf6/333?text=缩略图-6.6.6', rules: '夜市经典，实力挑战！规则：每人3个球，投进指定数量的桶里就能拿走对应的奖品。老板，拿那个最大的娃娃！' },
                { id: 'win-7', title: '采摘接力赛', subtitle: '奔跑吧，都市农夫', desc: '都市农夫，集结！根据神秘任务卡，冲向田野，寻找最新鲜的战利品。速度最快的队伍，将赢得丰收的荣耀！', img: 'https://placehold.co/786x384/ec4899/333?text=头图-6.6.7', thumb: 'https://placehold.co/128x128/ec4899/333?text=缩略图-6.6.7', rules: '按图索骥，全速前进！规则：根据任务卡上的蔬菜图片，以最快速度采摘到指定种类和数量的蔬菜，交给队友，用时最短的队伍获胜。' },
            ]
        },
        diyListPage: {
            title: "「作」· 慢时光工坊",
            color: "#8b5cf6",
            description: "静下心，与家人共创温馨。这里是释放创意的艺术天地。亲手制作一件小物，把家庭日的专属回忆和温度一起带回家。",
            items: [
                 { id: 'diy-1', title: '埃及马赛克灯', subtitle: '制作你的专属艺术品', desc: '亲手拼贴五彩斑斓的玻璃片，在光影交错中，打造一盏充满异域风情的土耳其马赛克灯。', img: 'https://placehold.co/786x384/c084fc/333?text=头图-6.7.1', thumb: 'https://placehold.co/128x128/c084fc/333?text=缩略图-6.7.1', rules: '体验土耳其的浪漫！规则：领取材料包，按照图纸或自由发挥，将彩色玻璃片粘贴在灯罩上，最后由工作人员帮你灌浆固定。' },
                 { id: 'diy-2', title: '手绘风铃', subtitle: '描绘夏日的声音', desc: '用画笔在清脆的玻璃风铃上描绘心情，创作一个独一无二的夏日风铃，让清风带去你的祝福。', img: 'https://placehold.co/786x384/a78bfa/333?text=头图-6.7.2', thumb: 'https://placehold.co/128x128/a78bfa/333?text=缩略图-6.7.2', rules: '画出夏天的声音！规则：选择你喜欢的玻璃风铃，用特制颜料在上面作画。画完后自然风干，就可以带走这份独一无二的纪念品。' },
                 { id: 'diy-3', title: '花草纸灯笼', subtitle: '点亮自然之美', desc: '将自然的花草融入传统纸张，亲手糊制一个散发着淡淡清香的灯笼，点亮温馨的夜晚。', img: 'https://placehold.co/786x384/7c3aed/333?text=头图-6.7.3', thumb: 'https://placehold.co/128x128/7c3aed/333?text=缩略图-6.7.3', rules: '把大自然包进灯里！规则：先用竹篾搭好灯笼骨架，再将带有美丽花草的纸张小心地糊在骨架上。一个古色古香的艺术品就诞生了。' },
            ]
        },
    };

    document.addEventListener('DOMContentLoaded', () => {
        new H5App('app-container');
    });
</script>
</body>
</html>

